<!DOCTYPE html>
<html class="app" dark="1">
<head>
	<title>CAM</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="../../dapi/css/web.css" />
	<link rel="stylesheet" href="../../dapi/css/icon.css" />
	<style>
	html,body{
		background: black;
		color: white;
	}
	.wall{
		background: black;
		color: white;
	}
	.wall .frame{
		position: absolute;
		background: #111;
		border: solid 1px black;
		overflow: hidden;
	}
	.wall .frame video {
		margin: auto;
		position: absolute;
		top: 0;
		bottom: 0;
	}
	.wall .frame .bar {
		position:absolute;
		margin:auto;
		top:0;
		left:0;
		right:0;
		background: black;
		color:white;
		text-align: center;
		font-size:8pt;
	}
	</style>
	<script src="../../dapi/js/aim.js"></script>
	<script src="../../dapi/js/web.js"></script>
	<script src="../../dapi/js/auth.js"></script>
	<script src="../../dapi/js/cam.js"></script>

	<script src="/api/lib/three/three.js"></script>
	<script src="/api/lib/three/OrbitControls.js"></script>


	<script>
	(function(){
		var size = {innerWidth: window.innerWidth, innerHeight: window.innerHeight} ;
		var size = {innerWidth: 200, innerHeight: 200} ;
		AIM.extend({
			config: {
				aim: {
					websocket: {
						servers: [{url: 'wss://aliconnect.nl:444'}]
					},
				},
			},
			auth: {
				access: {
					sub: 265090,
				}
			},
			on:{
				init() {
					console.log('INIT');
					// var vmsOptions = get;
					// webcam = new Webcam(vmsOptions);
					// webcam.startChat(vmsOptions);
					// return;
					let camera, scene, renderer;
					let mesh;

					init();
					animate();

					function init() {


						camera = new THREE.PerspectiveCamera( 70, size.innerWidth / size.innerHeight, 1, 1000 );
						camera.position.z = 400;

						scene = new THREE.Scene();

						const texture = new THREE.TextureLoader().load( 'crate.gif' );

						const geometry = new THREE.BoxBufferGeometry( 200, 200, 200 );
						const material = new THREE.MeshBasicMaterial( { map: texture } );

						mesh = new THREE.Mesh( geometry, material );
						scene.add( mesh );

						renderer = new THREE.WebGLRenderer( { antialias: true } );
						renderer.setPixelRatio( window.devicePixelRatio );
						renderer.setSize( size.innerWidth, size.innerHeight );
						document.body.appendChild( renderer.domElement );

						// document.body.appendChild( renderer.domElement );
						window.localStream = renderer.domElement.captureStream(25);
						renderer.domElement.style.display = 'none';


						//

						window.addEventListener( 'resize', onWindowResize, false );

					}

					function onWindowResize() {

						camera.aspect = size.innerWidth / size.innerHeight;
						camera.updateProjectionMatrix();

						renderer.setSize( size.innerWidth, size.innerHeight );

					}

					function animate() {

						requestAnimationFrame( animate );

						mesh.rotation.x += 0.005;
						mesh.rotation.y += 0.01;

						renderer.render( scene, camera );
						// console.log('done', renderer.domElement);
					}


					// return;
				}
			}
		});
	})();
	function go() {
		// var canvas = document.querySelector('canvas');
		// var video = document.querySelector('video');
		// console.log(canvas, video);
		// // Optional frames per second argument.
		// var stream = canvas.captureStream(25);
		// window.localStream = stream;
		// // Set the source of the <video> element to be the stream from the <canvas>.
		// video.srcObject = stream;
		// video.play();

		var vmsOptions = get;
		webcam = new Webcam(vmsOptions);
		webcam.startChat(vmsOptions);

	}
</script>
</head>
<body class='col'>
	<div id="btnbar" class="row top"><button>START</button><button onclick="go()">GO</button></div>
	<video width=300 height=300></video>
</body>
</html>
